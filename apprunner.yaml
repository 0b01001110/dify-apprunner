version: 1.0
runtime: docker
build:
  commands:
    build:
      - echo "Building Dify application"
run:
  command: gunicorn --bind 0.0.0.0:8080 --workers 1 --timeout 200 --preload --max-requests 1000 --max-requests-jitter 50 --log-level info app:app
  network:
    port: 8080
    env: PORT
  env:
    - name: MODE
      value: "app"
    - name: LOG_LEVEL
      value: "INFO"
    - name: SECRET_KEY
      value: "your-secret-key-here"
    - name: APP_WEB_URL
      value: "https://your-app-runner-url.com"
    - name: CONSOLE_WEB_URL
      value: "https://your-app-runner-url.com"
    - name: API_URL
      value: "https://your-app-runner-url.com"
    - name: APP_API_URL
      value: "https://your-app-runner-url.com"
    - name: CONSOLE_API_URL
      value: "https://your-app-runner-url.com"
    - name: SERVICE_API_URL
      value: "https://your-app-runner-url.com"
    - name: DB_USERNAME
      value: "postgres"
    - name: DB_PASSWORD
      value: "your-db-password"
    - name: DB_HOST
      value: "your-rds-endpoint"
    - name: DB_PORT
      value: "5432"
    - name: DB_DATABASE
      value: "dify"
    - name: REDIS_HOST
      value: "your-elasticache-endpoint"
    - name: REDIS_PORT
      value: "6379"
    - name: REDIS_PASSWORD
      value: "your-redis-password"
    - name: CELERY_BROKER_URL
      value: "redis://:your-redis-password@your-elasticache-endpoint:6379/1"
    - name: BROKER_USE_SSL
      value: "false"
    - name: WEB_API_CORS_ALLOW_ORIGINS
      value: "*"
    - name: CONSOLE_CORS_ALLOW_ORIGINS
      value: "*"